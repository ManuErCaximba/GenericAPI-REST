databaseChangeLog:
  - changeSet:
      id: 0008-add-role-to-users
      author: system
      changes:
        - addColumn:
            tableName: users
            columns:
              - column:
                  name: role
                  type: TEXT
                  defaultValue: 'USER'
        - sql:
            sql: UPDATE users SET role = 'USER' WHERE role IS NULL
        - sql:
            dbms: sqlite
            sql: |
              CREATE TABLE users_new (
                id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                first_name TEXT NOT NULL,
                last_name TEXT NOT NULL,
                email TEXT NOT NULL UNIQUE,
                password_hash TEXT NOT NULL,
                role TEXT NOT NULL,
                created_at NUMERIC NOT NULL
              );
              INSERT INTO users_new SELECT id, first_name, last_name, email, password_hash, role, created_at FROM users;
              DROP TABLE users;
              ALTER TABLE users_new RENAME TO users;
